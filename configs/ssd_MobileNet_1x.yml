#   Copyright (c) 2019 PaddlePaddle Authors. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
      
MODEL:
  TYPE: SSD
  BACKBONE: MobileNetV1Backbone
  CONV_GROUP_SCALE: 1
SSD_HEAD:
  TYPE: SSDHead
  FILTER_NUM_LIST: [[256, 512], [128, 256], [128, 256], [64, 128]]
  MIN_RATIO: 20
  MAX_RATIO: 90
  MIN_SIZES: [60.0, 105.0, 150.0, 195.0, 240.0, 285.0]
  MAX_SIZES: [[], 150.0, 195.0, 240.0, 285.0, 300.0]
  ASPECT_RATIOS: [[2.], [2., 3.], [2., 3.], [2., 3.], [2., 3.], [2., 3.]]
  CENTER_OFFSET: 0.5
  FLIP_ASPECT: True
  NMS_THRESH: 0.45
  
OPTIMIZER:
  TYPE: RMSProp
  LR_DECAY:
    POLICY: piecewise_decay
    BOUNDARIES: [10000, 15000, 20000, 25000]
    VALUES: [0.001, 0.0005, 0.00025, 0.0001, 0.00001]
  LR_WARMUP:
    WARMUP: OFF
  WEIGHT_DECAY:
    TYPE: L2
    FACTOR: 0.00005
    BN_DECAY: False
    
TRAIN:
  MAX_ITERS: 28000
  LOG_SMOOTH_WINDOW: 1
  SNAPSHOT_ITER: 1000
  PRETRAIN_WEIGHTS: ./ssd3/
  INPUT_SIZE: 300
  BATCH_NORM_TYPE: BN
  SHAPE: 300
  SAVE_DIR: ./results/
TEST:
  WEIGHTS: ./results/SSD/model_final/
  METRIC_TYPE: VOC
  INPUT_SIZE: 300
  
METRIC:
  AP_VERSION: 11point
  AP_OVERLAP_THRESH: 0.5
ENV:
  GPU: ON
DATA:
    TRAIN:
        ANNO_FILE: pascalvoc/VOCdevkit/VOC_all/ImageSets/Main/train.txt
        IMAGE_DIR: pascalvoc/VOCdevkit/VOC_all/JPEGImages
        SAMPLES: -1
        IS_SHUFFLE: True
        USE_DEFAULT_LABEL: False
        TYPE: VOCSource
    VAL:
        ANNO_FILE: pascalvoc/VOCdevkit/VOC_all/ImageSets/Main/val.txt
        IMAGE_DIR: pascalvoc/VOCdevkit/VOC_all/JPEGImages
        TYPE: VOCSource
        IS_SHUFFLE: False
        SAMPLES: -1
        
    TEST:
        ANNO_FILE: pascalvoc/VOCdevkit/VOC_all/ImageSets/Main/test.txt
        IMAGE_DIR: pascalvoc/VOCdevkit/VOC_all/JPEGImages
        TYPE: SimpleSource
        SAMPLES: 1
    CLASS_NUM: 21
TRANSFORM:
    TRAIN:
        OPS:
            - OP: DecodeImage
              TO_RGB: True
            - OP: NormalizeBox
            - OP: RandomDistort
              BRIGHTNESS_LOWER: 0.875
              BRIGHTNESS_UPPER: 1.125
              HUE_LOWER: -18
              HUE_UPPER: 18
              IS_ORDER: True
            - OP: ExpandImage
              MAX_RATIO: 3
              PROB: 0.5
            - OP: CropImage
              BATCH_SAMPLER: [[1, 1, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0],
                              [1, 50, 0.3, 1.0, 0.5, 2.0, 0.1, 0.0],
                              [1, 50, 0.3, 1.0, 0.5, 2.0, 0.3, 0.0],
                              [1, 50, 0.3, 1.0, 0.5, 2.0, 0.5, 0.0],
                              [1, 50, 0.3, 1.0, 0.5, 2.0, 0.7, 0.0],
                              [1, 50, 0.3, 1.0, 0.5, 2.0, 0.9, 0.0],
                              [1, 50, 0.3, 1.0, 0.5, 2.0, 0.0, 1.0]]
            - OP: ResizeImage
              TARGET_SIZE: 300
              USE_CV2: False
              Interp: 1
            - OP: RandomFlipImage
              IS_NORMALIZED: True
            - OP: Permute
            - OP: NormalizeImage
              MEAN: [127.5,127.5,127.5]
              STD: [127.502231,127.502231,127.502231]
              IS_SCALE: False
            - OP: ArrangeSSD
        BATCH_SIZE: 32
        DEVICES_NUM: 2
        IS_PADDING: False
        DROP_LAST: True
            
    VAL:
        OPS:
            - OP: DecodeImage
              TO_RGB: True
            - OP: NormalizeBox
            - OP: ResizeImage
              TARGET_SIZE: 300
              USE_CV2: False
              Interp: 1
            - OP: Permute
            - OP: NormalizeImage
              MEAN: [127.5,127.5,127.5]
              STD: [127.502231,127.502231,127.502231]
              IS_SCALE: False
            - OP: ArrangeSSD
        BATCH_SIZE: 64
        DEVICES_NUM: 2
        IS_PADDING: False
        DROP_LAST: False
            
            
    TEST:
        OPS:
            - OP: DecodeImage
              TO_RGB: True
            - OP: ResizeImage
              TARGET_SIZE: 300
              USE_CV2: False
              Interp: 1
            - OP: Permute
            - OP: NormalizeImage
              MEAN: [127.5,127.5,127.5]
              STD: [127.502231,127.502231,127.502231]
              IS_SCALE: False
            - OP: ArrangeTestSSD
        BATCH_SIZE: 1
        DEVICES_NUM: 1
        IS_PADDING: False
        DROP_LAST: False
    WORKER_CONF:
        BUFSIZE: 10
        WORKER_NUM: 8
        USE_PROCESS: True
  